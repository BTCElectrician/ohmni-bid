# Status

- Phase: implementation
- Review: ChatGPT 5.2 Pro response integrated; doc reviewed for completeness/correctness/trade gaps
- Guardrails: minimal code, maximize SDKs/services, keep files under ~500 lines
- Product notes: Stripe billing integration planned; spreadsheet UI + Excel export stay in scope
- Review packet: `docs/Ohmni_Bid_Final_Review.md` updated with external response + agent review notes
- Build progress:
  - Standardized embeddings default to `text-embedding-3-small`.
  - Added org/membership + walkthrough schema and RLS in `supabase/schema.sql`.
  - Added Supabase auth gating and estimate persistence in the UI.
  - Added walkthrough UI plus `/api/transcribe` and `/api/vision-count` routes.
  - Added assistant draft takeoff panel and `/api/draft-items` endpoint for reviewable line items.
  - Added paste-to-drafts line item importer in the assistant panel.
  - Added walkthrough latest-note fetch and estimate chat panel using `/api/ai`.
  - Draft-applied line items now retain `pricing_item_id` when available.
  - Refreshed UI styling with new typography, glass panels, and gradient backgrounds.
  - Archived legacy assets and prior integrations under `legacy/`.
  - Added embeddings backfill script for `pricing_items`.
  - Added one-brain Supabase setup doc and a single-command schema apply script.
  - Added pricing extraction + import scripts with stable `external_ref` support.
  - Removed legacy client branding references and normalized color token naming.
  - Added new-stack price sync monitor/email scripts and kept wrappers at repo root.
  - Added one-command pricing sync script for extract/import/backfill + mark synced.
  - Applied Supabase schema to the new project (via pooler connection).
  - Added walkthrough storage bucket + org-based storage policies to the schema.
  - Imported pricing items into Supabase (295 upserts) and completed embeddings backfill.
  - Added project details form and persisted prepared-by/bid-date in estimate metadata.
  - Expanded Excel export header with project details fields.
  - Clarified Supabase setup/env docs with connection string + key guidance.
  - Added ESLint config, excluded legacy from typecheck, and aligned server Supabase cookie handling.
  - Migrated lint script to ESLint CLI to avoid `next lint` deprecation.
  - Applied npm audit fixes (AI SDK v6), updated chat transport to text streaming, and refreshed tool schemas.
  - Added a dev auth bypass endpoint to allow local sign-in when magic link emails are rate-limited.
  - Scheduled local price sync email monitor via launchd (daily at 7:00am).
  - Upgraded AI SDK dependencies to restore chat/draft endpoints.
  - Hardened walkthrough AI upload error handling and allowed empty transcripts.
  - Added CLI smoke test script for AI + walkthrough endpoints.
  - Added category/unit dropdowns and numeric parsing in the estimate grid.
- Commit log (recent on main):
  - a42b683 feat(smoke): add cli smoke tests
  - e283666 fix(walkthrough): harden ai uploads
  - d10dce9 fix(ai): repair draft-items schema
  - e1c2043 fix(ai): update openai sdk
  - 4e620f2 feat(estimate): add paste importer
  - cdc4e53 fix(estimate): coerce line item numbers
  - 36bc320 fix(auth): bypass email send errors in dev
  - 1eb237f feat(pricing): add monitor email runner
  - 91b5fce chore(pricing): refresh pricing database
  - 9d93ce1 feat(pricing): add full sync script
  - dfe67b5 feat(pricing): add new-stack sync monitor
  - a6dab11 feat(auth): add dev bypass for local magic links
  - 80bc648 chore: apply audit fixes and update chat
  - cdca9f7 chore: migrate lint script
  - 4dea944 chore: add lint config and fix typecheck
  - 696e991 docs(status): refresh commit log
  - d57bcac feat: add project details and supabase sync updates
  - 8d3a726 docs(agents): document pricing update workflow
  - 35c91d6 feat(pricing): add extractor/import pipeline with external refs
  - 80d1f12 docs(ops): add one-brain Supabase setup flow
  - a5b1560 docs(status): log current commit stack and next steps
  - f68f106 feat(estimate): persist pricing item ids on line items
  - 0c80bbd feat(chat): add estimator chat panel and latest note fetch
  - 307897b feat(embeddings): add backfill script and update docs
  - bfcb418 feat(estimate): add assistant draft panel and draft-items API
  - 9f757ba Archive legacy assets and register model docs
  - da32c0c Keep Next.js tsconfig updates
  - f92a884 Implement chromium owl theme and walkthrough MVP
- Next steps:
  - Set OpenAI env vars for transcription/vision models in deployment.
  - Re-run `npm audit fix` when registry access is available (current ENOTFOUND).
